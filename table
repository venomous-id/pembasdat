-- 1. Tabel untuk entitas master (data yang jarang berubah)

-- Tabel Karyawan: Menyimpan data semua karyawan
CREATE TABLE Karyawan (
    KaryawanID VARCHAR(10) PRIMARY KEY,
    Nama VARCHAR(100) NOT NULL,
    Alamat TEXT,
    NoTelp VARCHAR(15),
    Jabatan VARCHAR(50)
);

-- Tabel Customer: Menyimpan data pelanggan
CREATE TABLE Customer (
    CustomerID VARCHAR(10) PRIMARY KEY,
    Nama VARCHAR(100) NOT NULL,
    Alamat TEXT,
    JenisKelamin CHAR(1) -- 'L' untuk Laki-laki, 'P' untuk Perempuan
);

-- Tabel Supplier: Menyimpan data pemasok barang
CREATE TABLE Supplier (
    SupplierID VARCHAR(10) PRIMARY KEY,
    NamaSupplier VARCHAR(100) NOT NULL,
    Alamat TEXT,
    NoTelp VARCHAR(15)
);

-- Tabel KategoriProduk: Menyimpan daftar kategori (BARU)
CREATE TABLE KategoriProduk (
    KategoriID VARCHAR(10) PRIMARY KEY,
    NamaKategori VARCHAR(100) NOT NULL
);

-- Tabel Produk: Menyimpan data produk (DIMODIFIKASI)
CREATE TABLE Produk (
    ProdukID VARCHAR(10) PRIMARY KEY,
    NamaProduk VARCHAR(100) NOT NULL,
    HargaJual DECIMAL(10, 2) NOT NULL,
    HargaBeli DECIMAL(10, 2) NOT NULL,
    KategoriID VARCHAR(10) REFERENCES KategoriProduk(KategoriID) -- Foreign Key ke Kategori
);

-- Tabel Gudang: Menyimpan data gudang
CREATE TABLE Gudang (
    GudangID VARCHAR(10) PRIMARY KEY,
    NamaGudang VARCHAR(100) NOT NULL,
    Lokasi TEXT
);

-- 2. Tabel untuk relasi (menghubungkan tabel master)

-- Tabel DISIMPAN: Menunjukkan produk mana disimpan di gudang mana
CREATE TABLE DISIMPAN (
    ProdukID VARCHAR(10) REFERENCES Produk(ProdukID),
    GudangID VARCHAR(10) REFERENCES Gudang(GudangID),
    Jumlah INT NOT NULL,
    PRIMARY KEY (ProdukID, GudangID) -- Composite Primary Key
);

-- 3. Tabel untuk transaksi

-- Tabel Transaksi_Penjualan: Header untuk setiap transaksi penjualan
CREATE TABLE Transaksi_Penjualan (
    TransaksiJualID VARCHAR(10) PRIMARY KEY,
    Tanggal DATE NOT NULL,
    CustomerID VARCHAR(10) REFERENCES Customer(CustomerID),
    KaryawanID VARCHAR(10) REFERENCES Karyawan(KaryawanID)
);

-- Tabel DetailTrx_Jual: Detail item barang dari setiap transaksi penjualan
CREATE TABLE DetailTrx_Jual (
    TransaksiJualID VARCHAR(10) REFERENCES Transaksi_Penjualan(TransaksiJualID),
    ProdukID VARCHAR(10) REFERENCES Produk(ProdukID),
    Jumlah INT NOT NULL,
    Subtotal DECIMAL(12, 2) NOT NULL,
    PRIMARY KEY (TransaksiJualID, ProdukID) -- Composite Primary Key
);

-- Tabel Transaksi_Pembelian: Header untuk setiap transaksi pembelian
CREATE TABLE Transaksi_Pembelian (
    TransaksiBeliID VARCHAR(10) PRIMARY KEY,
    Tanggal DATE NOT NULL,
    SupplierID VARCHAR(10) REFERENCES Supplier(SupplierID),
    KaryawanID VARCHAR(10) REFERENCES Karyawan(KaryawanID)
);

-- Tabel DetailTrx_Beli: Detail item barang dari setiap transaksi pembelian
CREATE TABLE DetailTrx_Beli (
    TransaksiBeliID VARCHAR(10) REFERENCES Transaksi_Pembelian(TransaksiBeliID),
    ProdukID VARCHAR(10) REFERENCES Produk(ProdukID),
    Jumlah INT NOT NULL,
    Subtotal DECIMAL(12, 2) NOT NULL,
    PRIMARY KEY (TransaksiBeliID, ProdukID) -- Composite Primary Key
);
